# AWS EC2

EC2(Elastic Compute Cloud)는 독립된 컴퓨터를 임대해주는 서비스입니다. 

본 수업의 하위 수업에서는 EC2의 개념과 사용방법을 알아봅니다. 

## EC2 소개

EC2 아마존 웹서비스의 대표적 상품.

AWS 콘솔로 들어가면 EC2 를 클릭. EC2의 지역을 선택.

EC2는 가장 먼저 생긴 서비스 중에 하나이고 가장 범용적인 서비스이면서 가장 관심있어 할만한 서비스임.

여러분에게 독립된 컴퓨터 한대를 통채로 임대해주는 상품임.

Instances = 컴퓨터 1대가 인스턴스 1대임. 

Launch Instance 버튼을 클릭하면 컴퓨터를 만들 수 있음. 그냥 클릭클릭클릭하면 컴퓨터가 금방 생성된다 라는 것만 느끼면됨.

단 1분만에 컴퓨터 1대가 만들어짐. 컴퓨터에 연격제어로 접속해서 컴퓨터가 마치 내 책상위 컴퓨터 처럼 원격으로 제어 가능.

조작하는 모습은 여러분의 상상에 맡기고 일단 생성하는 모습을 보여줌. 1분밖에 안걸렸다를 인상적으로 받아들여야됨.

더이상 컴퓨터가 필요없으면 오른쪽 클릭 Instance States - Terminate 를 클릭하면 컴퓨터가 삭제됨. 

## EC2 인스턴스 타입

Instances로 들어가야 인스턴스를 생성가능함. Launch Instance를 선택하면 인스턴스 생성 가능.

아마존 리눅스를 기본적으로 제공. 레드햇, 수세 리눅스, 우분투 제공. 이것들은 1년동안 무료로 사용가능한 제품들.

윈도우도 윈도우 서버 2012는 1년동안 무료로 사용할수 있음. 아마존 때문이 아니고 마소의 라이센스 정책 때문에..

우분투 선택

Choose an Instance Type (여러분의 임대 컴퓨터 사양을 선택.)

그중에 프리티어 선택. 나머지 컴퓨터는 컴퓨터를 키가마자 과금이 발생.

type = 각각의 컴퓨터의 사양. 가장 저렴하고 성능이 낮은건 nano

vCPUs(virtual CPU) = 몇개의 cpu가 달려있나.
Memory = 몇 기가의 메모리를 가지고 있나.
Network Performance = 네트워크 성능. (가격에 따라 차등이 있음)

AWS를 이용해서 여러가지를 하다보면 숫자에 대한 감각이 생김.

여러분이 하는 일에 따라 cpu가 강해야 되는 경우가 있고 메모리가 강해야되는 경우가 있음. 그것에 따라 상품이 구별되있음.

m으로 시작하는게 있고 c로 시작하는게 있음 (m은 메모리에 우위 c는 cpu에 우위) 자신의 환경에 따라 적합한 인스턴스 선택..

인스턴스 타입은 가격과 관련됨.

## EC2 가격정책

AWS EC2 Price 등으로 검색하면 가격정책을 수비게 볼 수 있음.(https://aws.amazon.com/ko/ec2/pricing/)

프리 티어

AWS의 프리 티어를 사용하는 신규 AWS 고객은 Amazon EC2를 무료로 시작할 수 있습니다. 신규 AWS 고객은 가입 시 1년 동안 매달 다음과 같은 EC2 서비스를 받게 됩니다.

* Linux, RHEL 또는 SLES를 구동하는 EC2 t2.micro 인스턴스 750시간 사용
* Microsoft Windows Server를 구동하는 EC2 t2.micro 인스턴스 750시간 사용
* Elastic Load Balancing 750시간 무료 사용 + 15GB의 데이터 처리 무료 제공
* 원하는 범용(SSD) 또는 마그네틱 조합으로 Amazon Elastic Block Storage 30GB + I/O 2백만 건(마그네틱) 및 스냅샷 스토리지 1GB
* 모든 AWS 서비스를 합산해 15GB의 데이터 전송
* 1GB의 리전 데이터 전송 무료 제공

**온디맨드 인스턴스**

여러분이 필요할때마다 컴퓨터를 키고 끌수 있는 인스턴스

리눅스냐 윈도우냐에 따라 가격차이 있음.

t2.micro 같은 경우 시간당 0.02달러 한국돈으로 20원? 게임방 생각하면 쌈. 하루에 480원정도? 한달에 14400원

잠깐 쓰면 가격경쟁력이 있음. 개발용이면 나노를 사용하게 되면 개발용으로는 충분할수 있음. 거의 7200원으로 쓸수있음.

제일 비싼 컴퓨터는 시간당 6700원  d2.8xlarge 컴퓨터 성능을 따지면 그렇게 비싼건 아님. (36코어 116메모리) 하루에 16만원

**예약 인스턴스**

켜고 끄거나 할때 경우에 따라 훨씬 저렴하게 사용할수있음 최대 75퍼 절약 할 수 있음.

**스팟 인스턴스**

아주 재미있고 특이한 인스턴스가 있음. 엄청난 컴퓨터를 아마존 웹 서비스가 보유하고 있음. (노는 컴퓨터가 항상 존재함)

노는 컴퓨터가 많으면 저렴. 노는 컴퓨터가 없으면 가격이 쎔

## EC2 인스턴스 장치설정

Number of instances = 생성하는 인스턴스 개수 1로 설정
Purchasing option Request Spot Instances 스팟 인스턴스를 하고 싶으면 체크(디폴트 체크 해제)
Shutdown behavior = stop (인스턴스일시정지), ternimate(인스턴스 삭제)
Monitoring = 체크시 돈이 부과된다.

Add Storage

EBS

Size 8 기본값 30기가 까지는 무료. 35기가 하면 유료

Volume Type : SSD가 훨씬 빠르겟죠? Magrtice보다

Delete on Termination 컴퓨터가 삭제되면 알아서 저장장치도 삭제됨. 체크해제하면 컴퓨터는 삭제되지만 하드는 삭제안됨. 기본값은 체크

## EC2 태그와 보안그룹

태그를 인스턴스에 붙이는 방법을 살펴볼 예정.

Tag Instance

Configure Security Group 

아주 중요한 부분. 일종의 방화벽 무료료 제공을 함.

이걸 하려면 지식이 필요함. 네트워크에 대해 조금 알아야됨. (오픈튜토리얼중에 인터넷 편을 들으면 됨 (ip, 도메인, port 등 설명))

우리가 만든 인스턴스에 접속하는 방식은 여러가지가 있을것. (원격접속, ftp, 웹서버 등) 모든 경우를 다 허용하는건 문을 여는거랑 다름 없기 때문에.

제한된 방법만을 통해 우리의 인스턴스로 접속하는 것을 허용하는 정책을 정하는 것. 리눅스의 경우 SSH는 기본 추가 되있음. (원격제어로 접속해야 되기 때문)

윈도우의경우 RDP가 지정되있음. (윈도우 원격접속은 RDP를 통해 제어하기 때문에)

## EC2 인스턴스 비밀번호 생성

인스턴스를 만드는 마지막 단계 까지옴.

서버 자원은 굉장히 소중해서. 복잡한 비밀번호를 써서 우리의 인스턴스를 공격으로 부터 방어하는 그러한 것임.

Create a new key pair로 비밀번호 발급 받을 수 있음 그리고 Download key Pair를 클릭하면 비밀번호를 다운받을 수 있음 그리고 우리의 인스턴스에 그 비밀번호를 심어놓음.

그래서 우리의 인스턴스를 접속하려면 그 비밀번호를 통해서 접속해야 됨. 공개키 비공개키.. 아마존에서 발급해주는 비밀번호는 엄청나게 긴 비밀번호이기 때문에. 안전함.

파일로 저장되있기 때문에 우리의 머리속에 있는 것보다는 위험함. (탈취될수있는 가능성이 한편으로 존재함) 양날의 검. 지금 다운 받은 파일을 굉장히 안전하고 소중하게 저장해야됨.

한번 파일을 다운받으면 다시는 비밀번호를 알려주지 않음. 그러면 여러분의 컴퓨터는 다시는 접속할 수 없는 상태가 됨. 아주 소중하게 다뤄야 됨.

## EC2 리눅스 인스턴스 접속

윈도우는 유닉스를 뿌리로 하는 운영체제와는 완전히 다른 운영체제임.

윈도우라는 운영체제에서 리눅스에 접속해서 원격제어를 하려고 하면.. 할 게 좀 있다. 뭘 설치를 해야됨.

윈도우에 SSH 역활을 해주는 프로그램을 직접 설치 해야됨. 원격제어 프로그램을 설치해야된다. 여러가지 프로그램이 있지만.. xshell 추천 (기업은 유료)

http://www.netsarang.co.kr/

좋네.. pem 바로 쓸 수 있음 (putty에서는 pem을 ppk로 변경해서 인식해야되는데.)

apache를 설치할 예정.

apache를 직접 설치하기에는 어려운 일임.. 그래서 우분투라는 운영체제에서 쉽게 설치할수 있는 기능이 있음.

sudo apt-get을 사용해서..

```
sudo apt-get update
sudo apt-get install apache2
```

설치하고 자신의 도메인 주소로 접속해서 화면이 뜨면 정상작동됨

자신의 도메인 주소는. AWS의 Public DNS임.


```
cd /var/www/html
sudo rm index.html
sudo nano index.html
```

[nano설명] (https://namu.wiki/w/nano)

## EC2 AWS Marketplace(Wordpress)

다른 사람의 인스턴스를 사용할 수 있다. 앱스토어를 생각 (앱스토어는 다른 사람이 만든 프로그램을 설치해서 사용하는 것)

아마존 웹 서비스에서 다른 사람이 만든 웹서비스를 쓴다는 것은 예를들어 워드프레스를 이용하면. 인스턴스를 만들고 필요한 소프트웨어(아파치, php, mysql 등) 그리고 워드프레스를 다운받고

설치하고, 보안관련 셋팅을 하고.. 등등 과정이 고되고 힘듬. 아무나 할수 있는게 아니고.. 이러한 경우에 이미 이 모든 과정을 끝낸 ami를 가지고 서비스를 하는 방법이 존재.

Instances로 들어가서 lanuch instance를 누르면 이미 각각의 운영체제도 이미 ami라고 해서 아마존에서 기본적으로 제공하는 이미지 였다..

여러분들이 자신이 만든 인스턴스를 이미지화 시킨것이 my amis 항목임. 다른 사람들이 만든 이미지를 가져다 쓰는 방법은 aws marketplace가 있음.

구글에서 검색. [aws marketplace](https://aws.amazon.com/marketplace) 여기서 원하는 서비스를 검색. ex) wordpress 

wordpress powered by bitnami(HVM)

중요하게 볼게 Pricing Details 임. 인스턴스 타입마다 가격이 다름. EC2 Usage 가격은 원래 ec2의 가격이고 softeware는 이 이미지를 제공한 이미지 생산자에게 지불해야되는 금액.

bitnami의 경우는 wordpress를 무료로 제공해서 아마존에게만 돈을 지급하면됨. 마치 앱스토어 처럼 이미지 스토어를 만든것임.

참고로 이걸로 워드프레스를 운영하는 입장이 아니라 혹시 놓치는게 있을 수 있음. 실제 서비스 시 훨씬 더 깊게 연구하고 테스트 해야됨

인스턴스가 생성되면 이메일이 오니 이메일에 중요한 정보들이 있으니 그걸 보고 여러가지 설정을 해주면 됨.

다른 사람이 만든 인스턴스를 너무나 쉽게 사용할 수 있음. 안전하고 쉽다. 상당히 편하고 안전하고 성능도 어느정도 보장할 수 있는 서비스를 빠른 속도로 만들 수 있음.

## EC2 Scalability - Scale Up

컴퓨터에 대한 수요는 시시각각 달라집니다. 

AWS EC2에는 이런 변화에 대응하기 위한 여러가기 기능을 가지고 있는데요. 

이번 시간에는 EC2 인스턴스의 규모를 유연하게 변경하는 방법을 알아봅니다.  

수업의 내용이 적지 않습니다. 꼼꼼하게 실습을 따라하는 것은 나중에 두번째 보실 때 하시고, 우선은 영상만 시청하면서 흐름을 파악하시는 것을 권하고 싶습니다.

1.5배속으로 보는 법 아시죠? 실습은 전체적인 맥락을 파악한 후에 하실 권합니다. 

scalability와 클라우딩 컴퓨팅의 관계.

ec2 인스턴스를 이용해서 우리가 여러대의 컴퓨터를 병렬로 연결하는. elb를 배우고.. 병렬로 연결될 컴퓨터를 자동의로 연결하고 삭제하는 (auto scaling)를 배우기 전 정리하는 과정.

지금까지는 실습 위주로 했지만. 이제는 이론적으로..

우선 우리가 살펴봤던 ec2의 가장 중요한 특징

* 가상화
* 종량제

ec2에 국한된게 아니고 클라우딩 컴퓨팅의 핵심적 아이디어.

가상머신이란? 가상 = 현실이 아니다 물리적인 컴퓨터가 아니고 물리적인 컴퓨터위에서 돌아가는 소프트웨어로 만든 거짓말 컴퓨터.

computer를 쓴다(물리적기계 필요) 

그 컴퓨터를 사용하기 위해서는 운영체제를 깔아야됨. 마소의 윈도우 맥의 osx 리눅스 등.. 운영체제가 하는 일 = 여러가지 소프트웨어 실행.

그렇게 설치된 소프트웨어는 운영체제를 통해서 기계를 제어함.

우리가 가상머신을 사용한다 하면. 운영체제에 프로그램을 하나 까는 것(여기서 생각하는 프로그램은 가상머신(소프트웨어로 만든 기계)) 자기가 정말 컴퓨터인 척 함 

하드웨어 적인 부분을 소프트웨어 적으로 만들었다. 이렇게 복잡한 일을 하는 이유?? 가상머신이 있기 때문에 가상머신을 여러개 만들어서 여러개의 운영체제를 설치할 수 있음

개인용 가상머신

* VMWare
* VirtualBox
* Parallels

지금 우리가 배우는 클라우딩 컴퓨팅은 개인용 시장을 겨냥한건 아님. 클라우딩 컴퓨팅의 가장 중요한 타겟은 기업이다. (대규모의 컴퓨팅 파워가 필요한.. 자원을 절약해야 하는..)

예를 들어 AWS의 회사는 많은 컴퓨터의 사용 요청이 있다. 그런것들이 가능하기 위해서 AWS같은 회사도 물리적 기계가 있어야됨. 여러분의 컴퓨터위에서 가상머신을 운영하기 위해서는 컴퓨터 한개가 있어야 되는것과 마찬가지

전세계의 컴퓨터를 만들어달라는 요청을 수용하기 위해서 아마존 같은 회사는 어마어마한 물리적 컴퓨터를 구비해놓음. 여러분이 AWS를 사용하는 입장이다.

두가지 경우

* 스타트업같은 경우 (사용자가 별로 없고, 개발하는거에 집중하고 싶은 경우)
* 거대한 기업이라 굉장한 컴퓨터가 필요한 경우

스타트업같은경우 나노 인스턴스 (저렴한 컴퓨터) 이렇게 후진 컴퓨터는 어디서 구할수도 없음. 이런 안좋은 컴퓨터가 필요한 이유? 싸니까.. 물리적 기계는 사이즈가 정해져있음.. 어떤 컴퓨터보다 성능이 안좋은 컴퓨터는 출시되지 않고

어떤 컴퓨터보다 성능이 좋은 컴퓨터는 출시되지 않음. 나노 컴퓨터로도 생각보다 많은 사용자를 수용할 수 있음. 

만약 여러분이 큰 회사고 강력한 컴퓨터가 필요하다. 그러면 x트라 라지 같은 인스턴스를 신청하면(강력한 컴퓨터) 그런 컴퓨터를 1분안에 만들어준다. 이게 가능한 이유? (물리적 컴퓨터를 여러개 묶어서 한대의 컴퓨터처럼 사용할 수 있게 함.)

저렴한 컴퓨터는 물리적 컴퓨터 한대를 여러개로 쪼개서 저렴한 컴퓨터 한대가 있는 것 같은 환상을 만들어줌.

우리가 클라우딩 컴퓨팅을 이용하는 것과 이용하지 않은 것의 차이??

**전통적인 모델**

물리적 컴퓨터는 가변적이지 않으므로 낭비되는 구간이 생길 수 밖에 없음

컴퓨팅 셋팅 시간도 오래 걸림.

최고점 까지 올라가서 만약 사용자의 수요가 떨어지면. 서비스의 품질은 매우 좋지만. 발생한 비용은 컴퓨터를 구매할때 사용한 비용. 네트워크 비용등.. 낭비됨. 팔려고 해도 잘 안팔림. 그만큼 손실

**클라우딩 컴퓨팅 모델**

수요와 공급을 맞출 수 있음 가변적으로. 낭비되는 공간 최소화.

빠르게 컴퓨터를 만들 수 있음. 그러다 사용자가 줄어든다?? 컴퓨터를 삭제하면 됨. 사용자가 는다? 컴퓨터를 산다..

비용 효율적이다. 그렇다고해서 클라우딩 컴퓨팅이 다 좋은 건 아니고.. 운영체제 위에 컴퓨터가 도는거라 퍼포먼스 적으로 패널티가 됨.

하지만 언제나 세상은 가변적이라.. 성능상으로 큰 이점이 있음.